-- The function to map a given date to a season
DROP FUNCTION IF EXISTS date_to_season;

DELIMITER !
CREATE FUNCTION date_to_season(game_date DATE) 
RETURNS YEAR DETERMINISTIC
BEGIN
    IF game_date < '2003-10-05' THEN
		RETURN YEAR('2002-01-01');
    ELSEIF game_date < '2004-10-12' THEN
		RETURN YEAR('2003-01-01');
    ELSEIF game_date < '2005-10-10' THEN
		RETURN YEAR('2004-01-01');
	ELSEIF game_date < '2006-10-05' THEN
		RETURN YEAR('2005-01-01');
	ELSEIF game_date < '2007-10-06' THEN
		RETURN YEAR('2006-01-01');
	ELSEIF game_date < '2008-10-05' THEN
		RETURN YEAR('2007-01-01');
	ELSEIF game_date < '2009-10-01' THEN
		RETURN YEAR('2008-01-01');
	ELSEIF game_date < '2010-10-03' THEN
		RETURN YEAR('2009-01-01');
	ELSEIF game_date < '2011-12-16' THEN
		RETURN YEAR('2010-01-01');
	ELSEIF game_date < '2012-10-05' THEN
		RETURN YEAR('2011-01-01');
	ELSEIF game_date < '2013-10-05' THEN
		RETURN YEAR('2012-01-01');
	ELSEIF game_date < '2014-10-04' THEN
		RETURN YEAR('2013-01-01');
	ELSEIF game_date < '2015-10-02' THEN
		RETURN YEAR('2014-01-01');
	ELSEIF game_date < '2016-10-01' THEN
		RETURN YEAR('2015-01-01');
	ELSEIF game_date < '2017-09-30' THEN
		RETURN YEAR('2016-01-01');
	ELSEIF game_date < '2018-09-28' THEN
		RETURN YEAR('2017-01-01');
	ELSEIF game_date < '2019-09-30' THEN
		RETURN YEAR('2018-01-01');
	ELSEIF game_date < '2020-12-11' THEN
		RETURN YEAR('2019-01-01');
	ELSEIF game_date < '2021-10-03' THEN
		RETURN YEAR('2020-01-01');
	ELSE
		RETURN YEAR('2021-01-01');
    END IF;
END !
DELIMITER ;
